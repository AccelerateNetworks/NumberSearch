@model NumberSearch.Mvc.PortNotifierResults;

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var alreadyInCart = Model?.Cart?.VerifiedPhoneNumbers.ToDictionary(x => x?.VerifiedDialedNumber, x => x);
}

<header class="navbar navbar-expand-lg navbar-light bg-light navbar-sticky navbar-shadow" data-scroll-header data-fixed-element>
  <div class="container px-0 px-xl-3">
    <button class="navbar-toggler ms-n2 me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#primaryMenu"><span class="navbar-toggler-icon"></span></button><a class="navbar-brand flex-shrink-0 order-lg-1 ms-lg-0 pe-lg-2 me-lg-4" href="/"><img class="d-none d-lg-block" src="/images/scaled/accelerate.png" alt="Accelerate Networks" width="153"><img class="d-lg-none" src="/images/scaled/favicon-194x194.png" alt="Accelerate Networks" width="58"></a>
    <div class="d-flex align-items-center order-lg-3 ms-lg-auto"><a class="nav-link-style fs-sm text-nowrap d-none d-lg-inline-block" href="tel:12068588757">Talk to an expert: <strong>(206) 858-8757</strong></a><a class="d-md-none text-reset" href="tel:12068588757"><i class="ai-phone fs-xl me-2 align-middle"></i></a><a class="btn btn-brand-secondary ms-grid-gutter d-none d-lg-inline-block" href="/pricing">Get started</a></div>
    <div class="offcanvas offcanvas-collapse order-lg-2" id="primaryMenu">
      <div class="offcanvas-header navbar-shadow">
        <h5 class="mt-1 mb-0">Menu</h5>
        <button class="btn-close lead" type="button" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        <!-- Menu-->
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="/features">Features</a></li>
          <li class="nav-item"><a class="nav-link" href="/pricing">Pricing</a></li>
          <li class="nav-item dropdown"><a class="nav-link" href="#" data-bs-toggle="dropdown">Resources</a>
            <div class="dropdown-menu" style="min-width:400px">
              <div class="row">
                <div class="col-sm-6"><a class="dropdown-item" href="/support">Knowledge base</a><a class="dropdown-item" href="/lookup">Port your number</a></div>
                <div class="col-sm-6"><a class="dropdown-item" href="https://blog.acceleratenetworks.com">Blog</a><a class="dropdown-item" href="/about">About us</a></div>
              </div>
            </div>
          </li>
        </ul>
      </div>
      <div class="offcanvas-footer border-top">
        <button class="btn btn-brand-secondary btn-sm w-100" type="button">Get started</button>
      </div>
    </div>
  </div>
</header>

<div class="container">
    <br />
    <div class="pricing-header mx-auto mb-3 text-center">
        <h1 class="display-4">Port Notifier</h1>
    </div>
    <p class="lead text-center mx-auto">
        Receive an email when the underlying carrier for a phone number changes.
    </p>
    <p>
        We keep a tab on any phone number you provide and let you know when it moves from one carrier to another. Every hour we check with our partners to verify the current status of the phone number and immediately report any change to you. If anything happens, we’ll be the first to let you know about it!
    </p>
    <br />
    <div class="jumbotron mb-3">
        <h1 class="display-4">Verify your Phone Number's details!</h1>
        <p>To see the current status of a phone number look it up here.</p>
        <form class="form-row justify-content-center">
            <div class="form-group">
                <div class="input-group mx-auto input-group-lg">
                    <div class="input-group-prepend">
                        <span class="input-group-text">+1</span>
                    </div>
                    <input type="text" name="Query" class="form-control" placeholder="Enter a Phone Number" value="@Model?.VerifiedPhoneNumber?.VerifiedDialedNumber">
                </div>
                <div class="input-group mx-auto input-group-lg pt-2">
                    <button type="submit" class="btn btn-success btn-block" onclick="displayBusyIndicator()">Verify</button>
                </div>
            </div>
        </form>
    </div>

    <partial name="_LoadingPartial" />

    @{
        if (Model != null && !string.IsNullOrWhiteSpace(Model?.VerifiedPhoneNumber?.VerifiedDialedNumber))
        {
            var alertType = Model?.AlertType ?? "alert-success";
            <div class="alert @alertType" role="alert">
                @{
                    var message = Model?.Message ?? "This phone number can be ported to our network!";
                }
                @message
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-borderless table-hover">
                    <tbody>
                        @{
                            var location = $"{Model.VerifiedPhoneNumber?.City ?? "Unknown City"}, {Model.VerifiedPhoneNumber?.Province ?? "Unknown State"}";
                            var formattedNumber = $"({Model.VerifiedPhoneNumber.NPA}) {Model.VerifiedPhoneNumber.NXX}-{Model.VerifiedPhoneNumber.XXXX.ToString("0000")}";
                            var number = Model.VerifiedPhoneNumber.VerifiedDialedNumber;
                            <tr>
                                <td scope="row"><h4>@formattedNumber</h4></td>
                                <td class="d-none d-sm-table-cell">@Html.Raw(number)</td>
                                <td class="d-none d-sm-table-cell">@location</td>
                                <td>
                                    @{
                                        if (alreadyInCart.TryGetValue(Model.VerifiedPhoneNumber.VerifiedDialedNumber, out var _))
                                        {
                                            <button onclick="RemoveFromCart('VerifiedPhoneNumber', '@Model.VerifiedPhoneNumber.VerifiedDialedNumber', 1, this)" class="btn btn-outline-danger">Remove</button>
                                        }
                                        else
                                        {
                                            <button onclick="AddToCart('VerifiedPhoneNumber', '@Model.VerifiedPhoneNumber.VerifiedDialedNumber', 1, this)" class="btn btn-outline-primary">Add to Cart</button>
                                        }
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="table-responsive">
                <table class="table table-striped table-hover table-borderless">
                    <thead>
                        <tr>
                            <th>
                                Phone Number
                            </th>
                            <th>
                                Last Port Date
                            </th>
                            <th>
                                Caller Name
                            </th>
                            <th>
                                Local Routing #
                            </th>
                            <th>
                                Carrier
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <h4>@Model?.VerifiedPhoneNumber?.VerifiedDialedNumber</h4>
                            </td>
                            <td>
                                @Model?.VerifiedPhoneNumber?.LastPorted
                            </td>
                            <td>
                                @Model?.VerifiedPhoneNumber?.LIDBName
                            </td>
                            <td>
                                <h4>@Model?.VerifiedPhoneNumber?.LocalRoutingNumber</h4>
                            </td>
                            <td>
                                <p>
                                    @Model?.VerifiedPhoneNumber?.ServiceProfileIdentifier
                                    -
                                    @Model?.VerifiedPhoneNumber?.LocalExchangeCarrier
                                    -
                                    @Model?.VerifiedPhoneNumber?.LocalExchangeCarrierType
                                </p>
                            </td>
                        </tr>
                    </tbody>
                </table>

            </div>
        }
    }
</div>
