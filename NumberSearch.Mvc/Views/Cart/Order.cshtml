@model NumberSearch.Mvc.Cart;

@{
    ViewData["Title"] = "Order";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <br />
    <div class="pricing-header mx-auto mb-3 text-center">
        @{
            if (Model?.Order?.OrderId == Guid.Empty)
            {
                <h1 class="display-4">Complete Your Order</h1>
            }
            else
            {
                <h1 class="display-4">Your Completed Order</h1>
            }
        }
    </div>
    <br />
    <div class="row">
        <div class="col-md-4 order-md-2 mb-4">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
                <span class="text-muted">Your Order</span>
                @{
                    var numbers = Model?.PhoneNumbers?.ToArray();
                    var products = Model?.Products?.ToArray();
                    var services = Model?.Services?.ToArray();
                    var sumOfitems = numbers.Length + products.Length + services.Length;
                    var productOrders = Model.ProductOrdersToDictionary();
                }
                <span class="badge badge-success badge-pill">@sumOfitems</span>
            </h4>
            <ul class="list-group mb-3">
                @{
                    var productsTotal = 0;
                    var servicesTotal = 0;
                    foreach (var number in numbers)
                    {
                        <li class="list-group-item d-flex justify-content-between lh-condensed">
                            <div>
                                <h6 class="my-0">Phone Number</h6>
                                <small class="text-muted">(@number.NPA) @number.NXX @number.XXXX</small>
                            </div>
                            <span class="text-muted">$20</span>
                        </li>
                    }
                    foreach (var product in products)
                    {
                        var productOrder = productOrders[product?.ProductId.ToString()];
                        var localTotal = productOrder.Quantity * product.Price;
                        productsTotal += localTotal;
                        <li class="list-group-item d-flex justify-content-between lh-condensed">
                            <div>
                                <h6 class="my-0">@product.Name</h6>
                                <small class="text-muted">@product.Description</small>
                            </div>
                            <span class="text-muted">$@localTotal</span>
                        </li>
                    }
                    foreach (var service in services)
                    {
                        var productOrder = productOrders[service?.ServiceId.ToString()];
                        var localTotal = productOrder.Quantity * service.Price;
                        servicesTotal += localTotal;
                        <li class="list-group-item d-flex justify-content-between lh-condensed">
                            <div>
                                <h6 class="my-0">@service.Name</h6>
                                <small class="text-muted">@service.Description</small>
                            </div>
                            <span class="text-muted">$@localTotal</span>
                        </li>
                    }
                }
                <li class="list-group-item d-flex justify-content-between">
                    <span>Total (USD)</span>
                    @{
                        var total = (numbers.Length * 20) + productsTotal + servicesTotal;
                        <strong>$@total</strong>
                    }
                </li>
            </ul>
        </div>
        <div class="col-md-8 order-md-1 pb-5">
            <h4 class="mb-3">Billing Information</h4>
            <form asp-controller="Cart" asp-action="Submit" method="post" class="needs-validation" novalidate="">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="firstName">First name</label>
                        <input asp-for="Order.FirstName" type="text" class="form-control" id="firstName" placeholder="Alexander" required="">
                        <div class="invalid-feedback">
                            Valid first name is required.
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="lastName">Last name</label>
                        <input asp-for="Order.LastName" type="text" class="form-control" id="lastName" placeholder="Bell" required="">
                        <div class="invalid-feedback">
                            Valid last name is required.
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label for="email">Email </label>
                    <input asp-for="Order.Email" type="email" class="form-control" id="email" placeholder="you@example.com">
                    <div class="invalid-feedback">
                        Please enter a valid email address for shipping updates.
                    </div>
                </div>

                <div class="mb-3">
                    <label for="address">Address</label>
                    <input asp-for="Order.Address" type="text" class="form-control" id="address" placeholder="1234 Main St" required="">
                    <div class="invalid-feedback">
                        Please enter your shipping address.
                    </div>
                </div>

                <div class="mb-3">
                    <label for="address2">Address 2 <span class="text-muted">(Optional)</span></label>
                    <input asp-for="Order.Address2" type="text" class="form-control" id="address2" placeholder="Apartment or suite">
                </div>

                <div class="row">
                    <div class="col-md-5 mb-3">
                        <label for="country">Country</label>
                        <select asp-for="Order.Country" class="custom-select d-block w-100" id="country" required="">
                            <option value="United States">United States</option>
                        </select>
                        <div class="invalid-feedback">
                            Please select a valid country.
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="state">State</label>
                        <select asp-for="Order.State" class="custom-select d-block w-100" id="state" required="">
                            <option value="">Choose...</option>
                            @{
                                var states = new string[] { "Alabama",
                                                        "Alaska",
                                                        "Arizona",
                                                        "Arkansas",
                                                        "California",
                                                        "Colorado",
                                                        "Connecticut",
                                                        "Delaware",
                                                        "Florida",
                                                        "Georgia",
                                                        "Hawaii",
                                                        "Idaho",
                                                        "Illinois",
                                                        "Indiana",
                                                        "Iowa",
                                                        "Kansas",
                                                        "Kentucky",
                                                        "Louisiana",
                                                        "Maine",
                                                        "Maryland",
                                                        "Massachusetts",
                                                        "Michigan",
                                                        "Minnesota",
                                                        "Mississippi",
                                                        "Missouri",
                                                        "Montana",
                                                        "Nebraska",
                                                        "Nevada",
                                                        "New Hampshire",
                                                        "New Jersey",
                                                        "New Mexico",
                                                        "New York",
                                                        "North Carolina",
                                                        "North Dakota",
                                                        "Ohio",
                                                        "Oklahoma",
                                                        "Oregon",
                                                        "Pennsylvania",
                                                        "Rhode Island",
                                                        "South Carolina",
                                                        "South Dakota",
                                                        "Tennessee",
                                                        "Texas",
                                                        "Utah",
                                                        "Vermont",
                                                        "Virginia",
                                                        "Washington",
                                                        "West Virginia",
                                                        "Wisconsin",
                                                        "Wyoming"
                                                        };

                                foreach (var state in states)
                                {
                                    <option>@state</option>
                                }
                            }
                        </select>
                        <div class="invalid-feedback">
                            Please provide a valid state.
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="zip">Zip</label>
                        <input asp-for="Order.Zip" type="text" class="form-control" id="zip" placeholder="" required="">
                        <div class="invalid-feedback">
                            Zip code required.
                        </div>
                    </div>
                </div>
                @{
                    if (Model?.Order?.OrderId == Guid.Empty)
                    {
                        <hr class="mb-4">
                        <button class="btn btn-primary btn-lg btn-block" type="submit" value="Submit">Submit your Order</button>
                    }
                }
                <br />
            </form>
        </div>
    </div>
</div>